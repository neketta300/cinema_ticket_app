# Отчет по лабораторной работе №5  
**Тема:** Технический долг. Устранение долга  

---

## 1. Инспекция проекта на наличие технического долга  
Проект Cinema Ticket App (разработан на Flutter с использованием Supabase) был проанализирован на наличие технического долга по указанным признакам.  

### 1.1. Непонятный/нечитабельный код  
- **Пример:** В файле `home_page_cinema.dart` метод `headerParts()` содержит сложную логику для отображения приветственного сообщения и аватара. Отсутствуют комментарии, объясняющие назначение `TextSpan` и логику обработки email.  
- **Пример:** В `reservation_screen.dart` метод `wlecomeBorder()` использует сложные `ClipPath` без пояснений, что затрудняет понимание логики отображения декоративной границы.  
- **Оценка:** Код читаем, но местами требует комментариев для улучшения понимания.  

### 1.2. Дублирующийся код  
- **Пример:** В `login_page.dart` и `register_page.dart` используются одинаковые стили для текстовых полей (`MyLogRegTextfield`) и кнопок (`LoginButton`), но нет единого подхода к обработке ошибок (например, `ScaffoldMessenger` для отображения ошибок).  
- **Пример:** В `reservation_screen.dart` и `home_page_cinema.dart` используются похожие стили для контейнеров (например, закругленные углы, тени), но без общих констант или виджетов.  
- **Оценка:** Дублирование присутствует, требует рефакторинга для выделения общих компонентов.  

### 1.3. Отсутствие автоматизации (тестов, сборки, развертывания)  
- **Тесты:** В проекте отсутствуют unit-тесты, widget-тесты и интеграционные тесты. Например, методы в `AuthService` (вход/регистрация) не покрыты тестами.  
- **Сборка/развертывание:** Отсутствует автоматизация сборки и публикации приложения.  
- **Оценка:** Полное отсутствие автоматизации, что увеличивает риск ошибок.  

### 1.4. Запутанная архитектура и ненужные сложные зависимости  
- **Пример:** В `cinema_main_screen.dart` используется `StatefulWidget` для управления навигацией, но логика переключения страниц (`navBarPage`) избыточно проста и могла бы быть реализована через `StatelessWidget`.  
- **Пример:** В `reservation_screen.dart` сложная логика выбора мест и времени могла бы быть разделена на отдельные сервисы или модели.  
- **Оценка:** Архитектура в целом понятна, но есть потенциал для упрощения.  

### 1.5. Медленные/неэффективные средства  
- **Пример:** В `home_page_cinema.dart` анимация `PageView.builder` может работать некорректно при быстром пролистывании (проблема с `PageController`), что снижает производительность.  
- **Пример:** В `movie_detail_page.dart` загрузка постеров через `Image.network` не оптимизирована (нет кэширования изображений).  
- **Оценка:** Есть проблемы с производительностью, требующие оптимизации.  

---

## 2. План мероприятий по устранению технического долга  

### 2.1. Непонятный/нечитабельный код  
- **Мероприятие:** Добавить комментарии к сложным участкам кода (например, `headerParts()`, `wlecomeBorder()`).  
- **Оценка:** 2 часа.  
- **Приоритет:** Средний.  

### 2.2. Дублирующийся код  
- **Мероприятие:** Выделить общие стили и виджеты в отдельные файлы (например, `CommonStyles.dart`, `ErrorHandler.dart`).  
- **Оценка:** 4 часа.  
- **Приоритет:** Высокий.  

### 2.3. Отсутствие автоматизации  
- **Мероприятие:** Написать unit-тесты для `AuthService` (вход/регистрация).  
- **Оценка:** 6 часов.  
- **Приоритет:** Высокий.  

### 2.4. Запутанная архитектура  
- **Мероприятие:** Упростить логику в `cinema_main_screen.dart`, перевести `navBarPage` в `StatelessWidget`.  
- **Оценка:** 2 часа.  
- **Приоритет:** Низкий.  
- **Мероприятие:** Разделить логику выбора мест в `reservation_screen.dart` на сервис `SeatSelectionService`.  
- **Оценка:** 3 часа.  
- **Приоритет:** Средний.  

### 2.5. Медленные/неэффективные средства  
- **Мероприятие 1:** Оптимизировать `PageController` в `home_page_cinema.dart`, добавить ограничения на скорость пролистывания.  
- **Оценка:** 3 часа.  
- **Приоритет:** Средний.  
- **Мероприятие 2:** Добавить кэширование изображений через `cached_network_image` в `movie_detail_page.dart`.  
- **Оценка:** 2 часа.  
- **Приоритет:** Высокий.  

---

## 3. Оценка плана мероприятий  
- **Общее время:** 22 часа.  
- **Приоритеты:**  
  - Высокий: 12 часов (тесты, дублирующийся код, производительность).  
  - Средний: 8 часов (комментарии, архитектура).  
  - Низкий: 2 часа (упрощение архитектуры).  

---

## 4. Сравнение объема долга и недоимплементированных фич  
- **Объем технического долга:** 22 часа (по оценке плана).  
- **Недоимплементированные фичи:**  
  - Добавление оплаты билетов (Feature E, в процессе реализации, оценка: 10 часов).  
  - Поддержка push-уведомлений (Feature F, в процессе реализации, оценка: 8 часов).  
  - Общий объем фич: 18 часов.  
- **Сравнение:** Технический долг (22 часа) превышает объем недоимплементированных фич (18 часов).  

---

## 5. Выводы и обоснование необходимости устранения долга  
- **Необходимость устранения:** Технический долг требует устранения, так как:  
  - Отсутствие тестов увеличивает риск багов на продакшене.  
  - Дублирующийся код затрудняет поддержку и масштабирование проекта.  
  - Проблемы с производительностью (например, анимации, загрузка изображений) снижают UX.  
- **Частичная необходимость:** Некоторые задачи (например, упрощение архитектуры) могут быть отложены, так как не критичны для текущего функционала.  
- **Коррективы в план разработки:**  
  - Сначала устранить долг с высоким приоритетом (12 часов).  
  - Затем реализовать фичи (18 часов).  
  - После завершения фич устранить долг со средним и низким приоритетом (10 часов).  

---

## 6. Краткий отчет  
- **Технический долг:** Выявлены проблемы с тестами, производительностью, дублирующимся кодом.  
- **План устранения:** 22 часа, приоритет на тестах, производительности, дублирующемся коде.  
- **Сравнение с фичами:** Долг (22 часа) превышает фичи (18 часов).  
- **Рекомендации:** Сначала устранить долг с высоким приоритетом, затем реализовать фичи, затем устранить оставшийся долг.  

---

## 7. Изменения плана разработки  
1. **Этап 1 (12 часов):** Устранение долга с высоким приоритетом (тесты, дублирующийся код, производительность).  
2. **Этап 2 (18 часов):** Реализация фич (оплата, уведомления).  
3. **Этап 3 (10 часов):** Устранение оставшегося долга (средний и низкий приоритет).  